{% extends 'sales/base.html' %}

{% block title %}{{ quotation.quotation_number }} - Quotation Details{% endblock %}
{% block header %}Quotation Details{% endblock %}

{% block header_buttons %}
<div class="btn-group">
    <a href="{% url 'quotation-update' quotation.pk %}" class="btn btn-primary">
        <i class="fas fa-edit me-2"></i>Edit
    </a>
    {% if quotation.status == 'draft' or quotation.status == 'sent' %}
    <a href="{% url 'convert-quotation-to-invoice' quotation.pk %}" class="btn btn-success">
        <i class="fas fa-file-invoice me-2"></i>Convert to Invoice
    </a>
    {% endif %}
    <a href="{% url 'quotation-pdf' quotation.pk %}" class="btn pdf-btn" target="_blank">
        <i class="fas fa-file-pdf me-2"></i>Download PDF
    </a>
    <button onclick="printDocument()" class="btn print-btn">
        <i class="fas fa-print me-2"></i>Print
    </button>
    <a href="{% url 'quotation-delete' quotation.pk %}" class="btn btn-danger">
        <i class="fas fa-trash me-2"></i>Delete
    </a>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Quotation: {{ quotation.quotation_number }}</h5>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6>Customer Information:</h6>
                        <strong>{{ quotation.customer.name }}</strong><br>
                        {{ quotation.customer.email }}<br>
                        {% if quotation.customer.phone %}
                            {{ quotation.customer.phone }}<br>
                        {% endif %}
                        {% if quotation.customer.company %}
                            {{ quotation.customer.company }}<br>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <h6>Quotation Details:</h6>
                        <strong>Date:</strong> {{ quotation.quotation_date }}<br>
                        <strong>Valid Until:</strong> {{ quotation.valid_until }}<br>
                        <strong>Status:</strong> 
                        <span class="badge bg-{% if quotation.status == 'accepted' %}success{% elif quotation.status == 'sent' %}info{% elif quotation.status == 'rejected' %}danger{% elif quotation.status == 'expired' %}warning{% else %}secondary{% endif %}">
                            {{ quotation.get_status_display }}
                        </span>
                    </div>
                </div>
                
                <h6>Items:</h6>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in quotation.items.all %}
                            <tr>
                                <td>{{ item.description }}</td>
                                <td>{{ item.quantity }}</td>
                                <td>{{ item.unit_price }} QAR</td>
                                <td>{{ item.line_total }} QAR</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-muted text-center">No items added yet</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                {% if quotation.notes %}
                <div class="mt-3">
                    <h6>Notes:</h6>
                    <p>{{ quotation.notes|linebreaks }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Summary</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                    <span>Subtotal:</span>
                    <span>{{ quotation.subtotal }} QAR</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span>Tax ({{ quotation.tax_rate }}%):</span>
                    <span>{{ quotation.tax_amount }} QAR</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between">
                    <strong>Total:</strong>
                    <strong>{{ quotation.total_amount }} QAR</strong>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">Actions</h5>
            </div>
            <div class="card-body">
                <a href="{% url 'quotation-list' %}" class="btn btn-outline-secondary w-100 mb-2">
                    <i class="fas fa-list me-2"></i>Back to List
                </a>
                {% if quotation.status == 'draft' or quotation.status == 'sent' %}
                <a href="{% url 'convert-quotation-to-invoice' quotation.pk %}" class="btn btn-success w-100 mb-2">
                    <i class="fas fa-file-invoice me-2"></i>Convert to Invoice
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}